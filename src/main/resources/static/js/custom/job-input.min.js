function openFile(b){let fileData=new FormData();let displayUpload=$("#FileUpload").get(0);let displayfiles=displayUpload.files;for(let i=0;i<displayfiles.length;i++){fileData.append("file",displayfiles[i]);var a=new FileReader();a.self=this;a.name=displayfiles[i].name;a.type=displayfiles[i].type;a.onload=function(d){var c=getextensionfile(this.name);if(c){$("#getContenOfFile").html(this.result);$(".displayitem").html("");$(".displayitem").append("<span>"+this.name+"</span>")}else{$(".displayitem").html("");$("#getContenOfFile").html("");return false}};a.readAsText(displayfiles[i])}$.ajax({type:"POST",url:"/nera/upload/playbook/get-output",data:fileData,contentType:false,processData:false,beforeSend:function(){},success:function(c){$(".notstandard").remove();for(let i=0;i<c.length;++i){readOutputRow(c[i].variable,c[i].value)}},error:function(c){}})}function readOutputRow(a,b){$("#tblPlaybookOutput").removeClass("hideclass");$("#tblPlaybookOutput > tbody:last").append('<tr class="notstandard"><td style="text-align:center" class="outputVariable outPutResize">'+a+'</td><td style="text-align:center" class="outputValue outPutResize">'+b+"</td></tr>")}function getextensionfile(b){var d="";var c=false;if(b!=""){d=b.replace(/^.*\./,"");if(d=="yml"){c=true}}return c}var fileListing=[];function changeFunc(d){var b=d;$("#selectedFile").val(b);var a="";for(var c=0;c<fileListing.length;c++){if(fileListing[c].id==b){a=fileListing[c].filename;downloadFileCSV(a);reDownload();return false}}}function downloadFileCSV(a){$.ajax({url:"/nera/upload/downloadFile/"+a,type:"GET",xhrFields:{responseType:"blob"},success:function(d){var e=new Blob([d],{type:".yml"});if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(e,a)}else{var b=document.createElement("a");var c=window.URL.createObjectURL(d);b.href=c;b.download=a;b.click();window.URL.revokeObjectURL(c)}},error:function(b){console.log(b)}})}function reDownload(){$(".redownload").on("click",function(){var b=$(this).attr("data-id");$("#selectedFile").val(b);var a="";for(var c=0;c<fileListing.length;c++){if(fileListing[c].id==b){a=fileListing[c].filename;downloadFileCSV(a);return false}}})}genNavigation("playbook");$(document).ready(function(){$("#kt_header_menu ul li span").text("Master Data/Playbook Listing/Detail");f();function f(){var o=$("#getPlaybookid").val();if(o>0){$(".layCreate").removeClass("hideclass")}$("#selectedType").select2({width:"resolve",dropdownAutoWidth:true})}function m(o,p){$("#tblPlaybookOutput").removeClass("hideclass");$("#tblPlaybookOutput > tbody:last").append('<tr class="notstandard"><td style="text-align:center" class="outputVariable">'+o+'</td><td style="text-align:center" class="outputValue">'+p+"</td></tr>")}$("#btnCancelJobInput").on("click",function(o){$("#jobinputworkflow").modal("hide")});$("#btnSaveJob").unbind().on("click",function(o){$("#jobinputworkflow").modal("hide")});n();function n(o){$("#btnCreateNewPlaybook").on("click",function(){var r=$("#pldGetPlaybookName").val();if(r==""){$(".nameRequired").removeClass("hideclass");return false}else{$(".nameRequired").addClass("hideclass")}var z=false;if($(".displayitem").text().trim()!=""){z=true;$(".uploadRequired").addClass("hideclass")}else{$(".uploadRequired").removeClass("hideclass");o.stopImmediatePropagation()}var y=$("#FileUpload").get(0);var q=y.files;var w=[];$("#tblPlaybookInput tbody .notstandard").each(function(){var B={type:$(this).find(".gettypevalue").text().trim(),variable:$(this).find(".getvariable").text().trim(),value:$(this).find(".getfilevalue").text().trim(),mandatory:$(this).find(".mandatorychecked").is(":checked"),fileManagementId:$(this).find(".getfilevalue").attr("data-id")};w.push(B)});var t=[];$("#tblPlaybookInput tbody .notstandard").each(function(){var B={inputtype:$(this).find(".gettypevalue").text().trim(),variable:$(this).find(".getvariable").text().trim(),value:$(this).find(".getfilevalue").text().trim(),mandatory:$(this).find(".mandatorychecked").is(":checked")};t.push(B)});var s=[];$("#tblPlaybookOutput tbody .notstandard").each(function(){var B={variable:$(this).find(".outputVariable").text().trim(),value:$(this).find(".outputValue").text().trim()};s.push(B)});var A=[];$("#tblPlaybookOutput tbody .notstandard").each(function(){var B={variable:$(this).find(".outputVariable").text().trim(),value:$(this).find(".outputValue").text().trim()};A.push(B)});var x=new FormData();if(z){for(var u=0;u<q.length;u++){x.append("file",q[u])}}var p={name:$("#pldGetPlaybookName").val(),playbookInput:w,playbookOutput:s,note:$("#pldNotes").val()};if($("#getPlaybookid").val()>0){p.status=$(".forstatus").attr("data-value");p.active=$("input[name=radio2]:checked").val()}else{p.status="NEW"}b(p,t,A);var v=0;if(z){v=q.length}let up=x;let cre=p;e(v,up,cre)})}function b(s,p,r){if(s.name==""){return false}$("#reName").text(s.name);if($("#getPlaybookid").val()>0){$("#reFile").html($(".displayitem").text().trim());$("#reFileContent").html($("#getContenOfFile").text().trim())}else{if($(".displayitem").text().trim()!=""){var u=$("#FileUpload").get(0);var t=u.files;if(t.length>0){var o=new FileReader();o.self=this;o.name=t[0].name;o.onload=function(v){$("#reFile").html(this.name);$("#reFileContent").html(this.result)};o.readAsText(t[0])}}}var q=p;$("#tblResultResponse > tbody").html("");for(let i=0;i<q.length;i++){c(q[i].inputtype,q[i].variable,q[i].value,q[i].mandatory)}$("#tblResultOuput > tbody").html("");for(let i=0;i<r.length;i++){l(r[i].variable,r[i].value)}$("#addPlaybookConfirmation").modal("show")}function e(q,o,p){$("#btnResultResponse").unbind().click(function(){console.log("len of create obj : __________"+p.length);if($("#getPlaybookid").val()>0){p.id=$("#getPlaybookid").val();if(q>0){if($(".displayitem").text().trim()!=""){d(o,p)}}else{p.fileName=$(".displayitem").text().trim();p.sourceUrl=$(".displayitem").attr("data-value");callUpdatePlaybookApi(p)}}else{if(q>0){d(o,p)}else{k(p)}}})}function d(o,p){$.ajax({type:"POST",url:"/nera/upload/playbook",data:o,contentType:false,processData:false,beforeSend:function(){},success:function(q){p.fileName=q.fileInfo.fileName;p.sourceUrl=q.fileInfo.fileDownloadUri;if($("#getPlaybookid").val()>0){callUpdatePlaybookApi(p)}else{k(p)}},error:function(q){}})}function k(o){$("#save-failed").css("display","none");$("#save-failed").empty();$.ajax({type:"POST",url:"/nera/playbook/api/save",data:JSON.stringify(o),contentType:"application/json",beforeSend:function(){},success:function(p){j();window.location.href="../playbook"},error:function(p){$("#save-failed").empty();if(p.status===400||p.status===500){$("#save-failed").append(p.responseJSON.detail)}else{$("#save-failed").append(p.statusText)}$("#save-failed").css("display","block");$("#save-failed").alert();$("#save-failed").delay(4000).hide(200)}})}function c(o,p,q,r){if(r==true){r='<td style="vertical-align: middle;"><input class="mandatorycheckbox" disabled="disabled" type="checkbox" checked="true"></td>'}else{r='<td class="resizeCol" style="vertical-align: middle;"><input disabled="disabled" type="checkbox"></td>'}$("#tblResultResponse > tbody:last").append('<tr><td class="textcen">'+o+'</td><td class="textcen" style="word-wrap: break-word; max-width: 200px;">'+p+'</td><td class="textcen" style="word-wrap: break-word; max-width: 205px;">'+q+"</td>"+r+"</tr>")}function l(o,p){$("#tblResultOuput > tbody:last").append('<tr><td class="textcen outPutConfirmResize">'+o+'</td><td class="textcen outPutConfirmResize">'+p+"</td></tr>")}a();function a(){var p=$("#getPlaybookid").val();if(p>0){$("#btnDeletePlaybook").removeClass("hideclass");$("#pldNotes").attr("readonly");var o={id:p};$.ajax({type:"GET",url:"/nera/playbook/api/get-by-id",data:o,contentType:"application/json",success:function(v){$("#pldGetPlaybookName").val(v.name);g(v.sourceUrl);$(".displayitem").attr("data-value",v.sourceUrl);var t=v.status;$(".forstatus").attr("data-value",t);if(t=="NEW"){$(".staNew").removeClass("hideclass")}if(t=="DRAFT"){$(".staDra").removeClass("hideclass")}if(t=="APPROVED"){$(".staApp").removeClass("hideclass");$(".layValiRemark").removeClass("hideclass");$("#pldRemark").attr("readonly","");$("#btnDeletePlaybook").removeClass("hideclass");$("#btnCreateNewPlaybook").removeClass("hideclass")}if(t=="REJECTED"){$(".staRej").removeClass("hideclass");$(".layValiRemark").removeClass("hideclass");$("#btnCreateNewPlaybook").addClass("hideclass")}$("#pldNotes").val(v.note);$("#pldRemark").val(v.remark);if(v.active==true){$("#radioA").prop("checked",true)}else{$("#radioI").prop("checked",true)}$("#tblPlaybookInput").removeClass("hideclass");if(v.playbookInput.length>0){var s=v.playbookInput;for(let i=0;i<s.length;i++){let col1=s[i].type;let col11=1;let col2=s[i].variable;let col3=s[i].value;let checked=s[i].mandatory;let col31;if(s[i].type=="Text"){col31=""}else{col31=s[i].fileManagementId==null?"":s[i].fileManagementId}appendNewRow(col1,col11,col2,col3,col31,checked)}}$("#tblPlaybookOutput").unbind().removeClass("hideclass");if(v.playbookOutput.length>0){var q=v.playbookOutput;for(let i=0;i<q.length;i++){var r=q[i].variable;var u=q[i].value;m(r,u)}}},error:function(q){}})}}function g(o){if(o==""){return false}$("#getContenOfFile").load(o,function(q,p,r){if(p=="success"){$(".displayitem").append("<span>"+o.split("/").pop()+"</span>")}if(p=="error"){console.log("Error: "+r.status+", "+r.statusText)}})}$("#btnBackToPlay").on("click",function(){if($("#getPlaybookid").val()>0){window.location.href="../../playbook"}else{window.location.href="../playbook"}});$("#btnDeletePlaybook").on("click",function(){$("#kt_modal_Delete").modal("show")});$("#btnYesDelete").on("click",function(){var o=$("#getPlaybookid").val();h(o)});function h(o){$.ajax({type:"POST",url:"/nera/playbook/api/delete-by-id",data:{id:o},beforeSend:function(){},success:function(p){j();$(".displaymessage").removeClass("hideclass");$(".deletemess").removeClass("hideclass");$("#kt_modal_Delete").modal("hide");setTimeout(function(){window.location.href="../../playbook"},2000)},error:function(p){}})}function j(){$.ajax({type:"GET",url:"/nera/playbook/api/count-approved-playbook",beforeSend:function(){},success:function(o){$(".setPlaybookApprovedCount").text("Playbook Approved ("+o+")")},error:function(o){}})}});