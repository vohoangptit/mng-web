<link rel="stylesheet" type="text/css"
	th:src="@{css/mxgraphlib/grapheditor/grapheditor.css}"
	 href="../../css/mxgraphlib/grapheditor/grapheditor.css">
<script th:inline="javascript">
// Parses URL parameters. Supported parameters are:
// - lang=xy: Specifies the language of the user interface.
// - touch=1: Enables a touch-style user interface.
// - storage=local: Enables HTML5 local storage.
// - chrome=0: Chromeless mode.

var urlParams = (function(url)
{
	var result = new Object();
	var idx = url.lastIndexOf('?');

	if (idx > 0)
	{
		var params = url.substring(idx + 1).split('&');
		
		for (var i = 0; i < params.length; i++)
		{
			idx = params[i].indexOf('=');
			
			if (idx > 0)
			{
				result[params[i].substring(0, idx)] = params[i].substring(idx + 1);
			}
		}
	}
	
	return result;
})(window.location.href);

// Default resources are included in grapheditor resources
mxLoadResources = false;
</script>

<script th:inline="javascript">
    var hasDeleteWorkflowPermission = [[${#strings.contains(session.userProfile.permission, 'DELETE_WORKFLOW')}]];
</script>

<script type="text/javascript" th:src="@{/js/mxgraphlib/js/Init.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/deflate/pako.min.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/deflate/base64.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/jcolor/jscolor.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/sanitizer/sanitizer.min.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/mxClient.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/js/EditorHistoryUi.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/js/Editor.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/js/Sidebar.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/js/Graph.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/js/Format.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/js/Shapes.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/js/Actions.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/js/Menus.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/js/Toolbar.js}" ></script>
<script type="text/javascript" th:src="@{/js/mxgraphlib/js/Dialogs.js}" ></script>

<!--end::Fonts -->

<!--end::Page Vendors Styles -->

<!--begin::Global Theme Styles(used by all pages) -->
<link href="css/vendors.bundle.css" th:href="@{/css/vendors.bundle.css}" rel="stylesheet" type="text/css" />

<link href="css/style.bundle.css" th:href="@{/css/style.bundle.css}" rel="stylesheet" type="text/css" />

<!--end::Global Theme Styles -->

<!--begin::Layout Skins(used by all pages) -->
<link href="css/base/dark.css" th:href="@{/css/base/dark.css}" rel="stylesheet" type="text/css" />

<link href="css/brand/dark.css" th:href="@{/css/brand/dark.css}" rel="stylesheet" type="text/css" />

<link href="css/aside/dark.css" th:href="@{/css/aside/dark.css}" rel="stylesheet" type="text/css" />

<link th:href="@{/css/animate.css}" href="../../css/animate.css" rel="stylesheet" type="text/css" />
<link th:href="@{/css/custom/playbook/playbookapproved-listing.css}"
	href="../../css/custom/playbook/playbookapproved-listing.css" rel="stylesheet"
    type="text/css" />

<link th:href="@{/css/custom/workflow/workflow-listing.css}" rel="stylesheet" type="text/css" />

<script th:src="@{/javascript/jquery-3.4.0.min.js}"></script>
<script th:src="@{/js/custom/common-layout.js}" type="text/javascript"></script>
<!--begin::Global Theme Bundle(used by all pages) -->

<script>
    var KTAppOptions = {
        "colors": {
            "state": {
                "brand": "#5d78ff",
                "dark": "#282a3c",
                "light": "#ffffff",
                "primary": "#5867dd",
                "success": "#34bfa3",
                "info": "#36a3f7",
                "warning": "#ffb822",
                "danger": "#fd3995"
            },
            "base": {
                "label": ["#c5cbe3", "#a1a8c3", "#3d4465", "#3e4466"],
                "shape": ["#f0f3ff", "#d9dffa", "#afb4d4", "#646c9a"]
            }
        }
    };
</script>
<script th:src="@{/js/bundle/vendors.bundle.js}" type="text/javascript"></script>
<script th:src="@{/js/bundle/scripts.bundle.js}" type="text/javascript"></script>

<!--end::Global Theme Bundle -->

<!--begin::Page Vendors(used by this page) -->
<script th:src="@{/js/bundle/fullcalendar.bundle.js}" type="text/javascript"></script>
<script src="//maps.google.com/maps/api/js?key=AIzaSyBTGnKT7dt597vo9QgeQ7BFhvSRP4eiMSM" type="text/javascript"></script>
<script th:src="@{/js/bundle/gmaps.js}" type="text/javascript"></script>

<!--end::Page Vendors -->

<!--begin::Page Scripts(used by this page) -->
<script th:src="@{/js/bundle/dashboard.js}" type="text/javascript"></script>

<!--end::Page Scripts -->

<!--begin::Global App Bundle(used by all pages) -->
<script th:src="@{/js/bundle/app.bundle.js}" type="text/javascript"></script>
<script th:src="@{/js/custom/playbookfor-workflow.js}" type="text/javascript"></script>
<script th:src="@{/js/custom/job-input.js}" type="text/javascript"></script>
<script th:src="@{/js/custom/workflow-listing.js}" type="text/javascript"></script>

<body class="kt-header--fixed kt-header-mobile--fixed kt-subheader--fixed kt-subheader--enabled kt-subheader--solid kt-aside--enabled kt-aside--fixed" id="geEditor">
	<script th:inline="javascript">
		// Extends EditorUi to update I/O action states based on availability of backend
		
		var workflowid = $('#workflowid', parent.document).val();
		(function()
		{
			var editorUiInit = EditorUi.prototype.init;

			EditorUi.prototype.init = function()
			{
				editorUiInit.apply(this, arguments);
				
				// Updates action states which require a backend
				/* if (!Editor.useLocalStorage)
				{
					mxUtils.post(OPEN_URL, '', mxUtils.bind(this, function(req)
					{
						var enabled = req.getStatus() != 404;
						this.actions.get('open').setEnabled(enabled || Graph.fileSupport);
						this.actions.get('import').setEnabled(enabled || Graph.fileSupport);
						this.actions.get('save').setEnabled(enabled);
						this.actions.get('saveAs').setEnabled(enabled);
						this.actions.get('export').setEnabled(enabled);
					}));
				} */

				// console.log(this.editor.graph);
				$('input').attr('readonly', true);
				if(workflowid != null && workflowid != '')
				{
					var graph = this.editor.graph;
					graph.setGridEnabled(false);
					graph.setAutoSizeCells(true);
					graph.pageFormat = new mxRectangle(0, 0, 2766, 1100); 
					graph.setCellsEditable(false);
					var json = {'id':parseInt(workflowid)};
					$.ajax({
						type: 'POST',
						url: '/nera/api/load-history-workflow',
						data: json,
						success: function (data) {
							console.log(data);
							var version = data.version === 0 ? 1 : data.version;
							$('#WorkflowName').val(data.name);
							$('#DescriptionName').val(data.description);
							$('#versionWorkflow').text("Version " + version);
							$('#txtVersion').val(version);
							$('#wfId').val(data.workflowId);
							var workflowOperators = data.workflowOperatorHistories;
							var contentXml = '';
							$.each(workflowOperators,function(i,operator)
							{
								contentXml += operator.contentXML;
								// console.log(xml);
							});
							var xml = '<mxGraphModel><root><mxCell id="0"/><mxCell id="1" parent="0"/>';
								xml += contentXml;
							xml += '</root></mxGraphModel>';
							
							// var parent = graph.getDefaultParent();
							graph.getModel().beginUpdate();
							try
							{
							console.log(xml);
							// 	var v1 = graph.insertVertex(parent, 'start', 'Start', 20, 20, 80, 30,'shape=ellipse;fillColor=black;fontColor=white');
							// 	var v2 = graph.insertVertex(parent, 'end', 'End', 200, 150, 80, 30,'shape=ellipse;fillColor=white;fontColor=black');
							// 	console.log(graph.getCellStyle(v2));
								// var e1 = graph.insertEdge(parent, null, '', v1, v2);
								var doc = mxUtils.parseXml(xml);
								console.log(doc);
								var codec = new mxCodec(doc);
								// var model = new mxGraphModel();
								codec.decode(doc.documentElement, graph.getModel());
								var parent = graph.getDefaultParent();
								// console.log(graph.getModel().root.getChildAt(0));
							}
							finally
							{
								// Updates the display
								graph.getModel().endUpdate();
							}
						}
					});
				}
				else
				{
					var graph = this.editor.graph;
					graph.setGridEnabled(false);
					var parent = graph.getDefaultParent();
					graph.getModel().beginUpdate();
					graph.pageFormat = new mxRectangle(0, 0, 2766, 1100); 
					try
					{
					// 	var v1 = graph.insertVertex(parent, 'start', 'Start', 20, 20, 80, 30,'shape=ellipse;fillColor=black;fontColor=white');
					// 	var v2 = graph.insertVertex(parent, 'end', 'End', 200, 150, 80, 30,'shape=ellipse;fillColor=white;fontColor=black');
					// 	console.log(graph.getCellStyle(v2));
						// var e1 = graph.insertEdge(parent, null, '', v1, v2);
						var doc = mxUtils.parseXml('<mxGraphModel><root><mxCell id="0"/><mxCell id="1" parent="0"/><UserObject label="Start" id="star"><mxCell id="start1"  style="shape=ellipse;fillColor=black;fontColor=white;" vertex="1" parent="1"><mxGeometry x="20" y="20" width="80" height="60" as="geometry"/></mxCell></UserObject><UserObject label="End" id="end1"><mxCell id="end"  style="shape=ellipse;fillColor=white;fontColor=black" vertex="1" parent="1"><mxGeometry x="200" y="150" width="80" height="60" as="geometry"/></mxCell></UserObject></root></mxGraphModel>');
						var codec = new mxCodec(doc);
						// var model = new mxGraphModel();

						codec.decode(doc.documentElement, graph.getModel());
						var parent = graph.getDefaultParent();
						// console.log(graph.getModel().root.getChildAt(0));
					}
					finally
					{
						// Updates the display
						graph.getModel().endUpdate();
					}
				}				
				console.log(graph);
			};
			
			
			// Adds required resources (disables loading of fallback properties, this can only
			// be used if we know that all keys are defined in the language specific file)
			mxResources.loadDefaultBundle = false;
			var bundle = mxResources.getDefaultBundle(RESOURCE_BASE, mxLanguage) ||
				mxResources.getSpecialBundle(RESOURCE_BASE, mxLanguage);
			console.log(bundle);
			// Fixes possible asynchronous requests
			mxUtils.getAll([bundle, STYLE_PATH + '/default.xml'], function(xhr)
			{
				// Adds bundle text to resources
				mxResources.parse(xhr[0].getText());
				
				// Configures the default graph theme
				var themes = new Object();
				themes[Graph.prototype.defaultThemeName] = xhr[1].getDocumentElement(); 
				
				// Main
				new EditorUi(new Editor(urlParams['chrome'] == '0', themes));
				
			}, function()
			{
				document.body.innerHTML = '<center style="margin-top:10%;">Error loading resource files. Please check browser console.</center>';
			});
		})();
	</script>
	<input type="hidden" id="wfId"/>
	<div class="modal" id="playbookworkflow" tabindex="-1" role="dialog" data-keyboard="false" data-backdrop="static">
		<div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Playbook </h5>
				</div>
				<div class="modal-body">
					<div class="col-md-12">

						<div class="row search-padd">
							<div class="col-md-12 row search-padd">
								<div class="col-md-5">
									<input type="text" class="form-control search-input" placeholder="search" id="playbookSearch">
									<span class="search-icon">
										<span><em class="la la-search"></em></span>
									</span>
								</div>

								<div class="col-md-7">
									<a href="#" class="btn btn-brand btn-elevate btn-icon-sm" id="btnSearchPlaybook">
										<span>Search</span>
									</a>
								</div>
							</div>
						</div>
					</div>
					<div th:replace="custom/status/status"></div>
					<div class="col-md-12">
						<div class="userGroupListingDatatable">
							<table id="playbookTable"  class="table table-bordered table-condensed table-striped table-hover" style="width: 100%;">
								<caption style="visibility: hidden;">Listing Playbook</caption>
								<thead class="table-listing">
									<tr>
										<th scope="col" style="width: 40%">Playbook Name</th>
										<th scope="col" style="width: 30%">Approved Date</th>
										<th scope="col" style="width: 30%">Approved By</th>
									</tr>
								</thead>
								<tbody>

								</tbody>
							</table>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-add-default" id="btnSelect"><em class="la la-check-circle"></em>Select</button>
                    <button type="button" class="btn btn-cancel" id="btnCancel"><em class="la la-times-circle"></em>Cancel</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal" id="playbookworkflowApproveStatus" tabindex="-1" role="dialog" data-keyboard="false" data-backdrop="static">
		<div class="modal-dialog modal-md modal-dialog-scrollable" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Approver List</h5>
				</div>
				<div class="modal-body">
					<div class="col-md-12">
						<div class="row search-padd">
							<div class="col-md-12 row search-padd">
								<div class="col-md-10">
									<input type="text" class="form-control search-input" placeholder="search" id="approvedSearch">
									<span class="search-icon">
										<span><em class="la la-search"></em></span>
									</span>
								</div>

								<div class="col-md-2" style="padding-left: 22px;">
									<a href="#" class="btn btn-brand btn-elevate btn-icon-sm" id="btnSearchUserApproved">
										<span>Search</span>
									</a>
								</div>
							</div>
						</div>
					</div>
					<div th:replace="custom/status/status"></div>
					<div class="col-md-12">
						<table id="playbookApproveTable" class="table table-bordered table-condensed table-striped table-hover" style="width: 100%;">
							<caption style="visibility: hidden;">Playbook Approve</caption>
							<thead>
								<tr class="textcen">
									<th scope="col" style="width: 10%"><input type="checkbox" value="" name="checkAllData" onClick="selectAll(this)"/></th>
									<th scope="col" style="width: 40%">Approver</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-add-default" id="btnSelectApprove"><em class="la la-check-circle"></em>Select</button>
					<button type="button" class="btn btn-cancel" id="btnCancelApprove"><em class="la la-times-circle"></em>Cancel</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal" id="cancelWorkflow" tabindex="-1" role="dialog" data-keyboard="false" data-backdrop="static">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Cancel a workflow</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<p>You are about to cancel any modifications done to this workflow</p>
                    <p>Are you sure to proceed without saving?</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-add-default" id="btnLeavePageWorkflow">Leave</button>
					<button type="button" class="btn btn-cancel" data-dismiss="modal"><em class="la la-times-circle"></em>Cancel</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="modalDetailPlaybook" tabindex="-1" role="dialog" data-keyboard="false" data-backdrop="static">
		<div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Playbook details</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">�</span>
					</button>
				</div>
				<div class="modal-body">
					<div th:replace="custom/status/statusInventory"></div>
					<div class="col-md-12">
						<div class="row">
							<div class="col-3 col-form-label">Playbook Name</div>
							<div class="col-9 col-form-label">
								<input class="form-control" type="text" value="" id="playBookName" disabled>
							</div>
						</div>
						<div class="row">
							<div class="col-3 col-form-label"></div>
							<div class="col-9 col-form-label">
								<div class="displayitem col-8" data-value=""></div>
							</div>
						</div>
						<div class="row">
							<div class="col-3 col-form-label">Playbook Content</div>
							<div class="col-9">
								<textarea class="form-control" readonly="" rows="6" id="getContentOfFile" style="min-height: 320px; background: #f8f8f8"></textarea>
							</div>
						</div>
						<div class="row">
							<div class="col-3 col-form-label">Playbook Input</div>
							<div class="col-9 col-form-label">
								<table class="table hideclass" id="tblPlaybookInput" style="border:1px solid #ccc!important">
									<caption style="visibility: hidden;">Playbook Input</caption>
									<thead style="background:#ccc!important">
									<tr>
										<th scope="col" style="width: 30%; text-align: center;">Input Type</th>
										<th scope="col" style="width: 35%; text-align: center;">Variable</th>
										<th scope="col" style="width: 35%; text-align: center;">Default Value</th>
									</tr>
									</thead>
									<tbody>
										<tr class="standard">
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<div class="row">
							<div class="col-3 col-form-label">Playbook Output</div>
							<div class="col-9 col-form-label">
								<table class="table hideclass" id="tblPlaybookOutput" style="border:1px solid #ccc!important">
									<caption style="visibility: hidden;">Playbook Output</caption>
									<thead style="background:#ccc!important">
										<tr>
											<th scope="col" style="width: 50%; text-align: center;">Variable</th>
											<th scope="col" style="width: 50%; text-align: center;">Default Value</th>
										</tr>
									</thead>
									<tbody>
									<tr class="standardOutput">
									</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-cancel" data-dismiss="modal">
						<em class="la la-times-circle"></em>Back</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal" id="jobinputworkflow" tabindex="-1" role="dialog" data-keyboard="false" data-backdrop="static">
			<div class="modal-dialog modal-lg" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Playbook Input</h5>
						</div>
						<div class="modal-body">
								<div class="col-md-12">
									<table class="table" id="tblPlaybookInput2" style="border:1px solid #ccc!important">
										<caption style="visibility: hidden;">Playbook Input</caption>
										<thead style="background: lightgray">
											<tr>
												<th scope="col" style="width: 20%" class="textcen">Input Type</th>
												<th scope="col" style="width: 50%" class="textcen">Variable</th>
												<th scope="col" style="width: 30%" class="textcen">Action</th>
											</tr>
										</thead>
										<tbody>
											<tr class="standard" id = "tblAddInput">
												<td>
													<select style="width: 115%" class="form-control" id="selectedType" onchange='changeFieldFunc()'>
														<option value="1">Text</option>
														<option value="2">File</option>
													</select>
												</td>
												<td style="text-align:center;">
													<input type="hidden" value="" id="txtIdJobInput" />
													<div id="changeofinput"><input class="form-control" style="text-align:center; width:90%; margin-left:10%" type="text" value="" id="pldVariable"></div>
													<div class="hideclass" id="changeoftype">
														<select class="form-control hideclass" id="selectedFile"></select>

														<select class="form-control" id="selectedFileTest" onchange="getFileDownload(value)" style="width:100%; height:38px;"></select>
													</div>
												</td>
												<td class="hideclass"></td>
												<td style="text-align:center;">
													<span>
														<a href="#" class="btn btn-hover-brand btn-icon btn-pill pldConfirm"><em class="la la-plus-circle"></em></a>
													</span>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
						</div>
						<div class="modal-footer">
								<button type="button" class="btn btn-cancel" id="btnCancelJobInput"><em class="la la-times-circle"></em>Close</button>
						</div>
					</div>
			</div>
	</div>
	<div class="modal" id="saveWorkflowConfirmation" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-keyboard="false" data-backdrop="static">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Confirmation</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					</button>
				</div>
				<div class="modal-body">
					<div class="hideclass"><input value="" id="hostDeleteId"></div>
					<p>You are about to save this workflow. Please click Yes to confirm.</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-add-default" id="btnYesSaveWorkflow">
						<em class="la la-floppy-o"></em>Yes</button>
					<button type="button" class="btn btn-cancel" data-dismiss="modal">
						<em class="la la-times-circle"></em>No</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal" id="deleteWorkflowConfirmation" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalDeleteLabel">Delete a workflow</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					</button>
				</div>
				<div class="modal-body">
					<p>You are about to delete this workflow. Are you sure you want to delete delete the workflow</p>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-add-default" id="btnYesDeleteWorkflow">
						<em class="la la-floppy-o"></em>Yes</button>
					<button type="button" class="btn btn-cancel" data-dismiss="modal">
						<em class="la la-times-circle"></em>No</button>
				</div>
			</div>
		</div>
	</div>
	<div id="main" style="z-index: -1;float: right;position: absolute; top: 86px;overflow: auto;right: 0px">
		<button class="openbtn" id="btnShowtoggle" onclick="openNav()">
            <em class="la la-angle-left"></em>
        </button>
	</div>
	<div id="properties" class="responsive-properties responsive-width-properties font-properties layout-properties-workflow"  style="z-index: -1;">
	</div>
	<script th:inline="javascript">
		function closeNav() {
			$('#properties').removeClass('responsive-width-properties');
            $('#properties').addClass('responsive-width-button');
			$('#main').css("z-index", "10");
		}
		function openNav() {
			$('#properties').addClass('responsive-width-properties');
            $('#properties').removeClass('responsive-width-button');
			$('#main').css("z-index", "-10");
		}
	</script>
</body>


